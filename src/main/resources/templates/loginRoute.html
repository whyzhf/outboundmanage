<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <style type="text/css">
        body,html,#container{
            width: 100%;
            height: 100%;
            margin: 0px
        }
    </style>
    <title>API加载</title>
</head>
<body>
<div id="container" tabindex="0"></div>
<script src="https://webapi.amap.com/maps?v=1.4.15&key=ea332a8e30bdf60db9402e1ad6493293&callback=init"></script>
<script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
<!--<script src="//webapi.amap.com/ui/1.0/main.js"></script>-->

<!--预加载 SimpleMarker -->
<script src="//webapi.amap.com/ui/1.0/ui/overlay/SimpleMarker.js"></script>
<script type="text/javascript" src="https://webapi.amap.com/demos/js/liteToolbar.js"></script>
<script type="text/javascript">
    window.init = function(){
        var map = new AMap.Map('container', {
            resizeEnable: true,
            // center:[116.480983, 39.989628],
            zoom:4
        });
        if (location.href.indexOf('guide=1') !== -1) {
            map.setStatus({scrollWheel: false});
            map.plugin(["AMap.ToolBar"], function() {
                map.addControl(new AMap.ToolBar({liteStyle:true}))
            });
        }
        AMap.plugin(['AMap.ToolBar','AMap.Scale','AMap.OverView'],function(){
            map.addControl(new AMap.ToolBar());
            map.addControl(new AMap.Scale());
            map.addControl(new AMap.OverView({isOpen:true}));
        })

        AMapUI.load(['ui/misc/PathSimplifier', 'lib/$'], function(PathSimplifier, $) {

            if (!PathSimplifier.supportCanvas) {
                alert('当前环境不支持 Canvas！');
                return;
            }

            //just some colors
            var colors = [
                "#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477", "#66aa00",
                "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc", "#e67300", "#8b0707",
                "#651067", "#329262", "#5574a6", "#3b3eac"
            ];

            var pathSimplifierIns = new PathSimplifier({
                zIndex: 100,
                //autoSetFitView:false,
                map: map, //所属的地图实例

                getPath: function(pathData, pathIndex) {

                    return pathData.path;
                },
                getHoverTitle: function(pathData, pathIndex, pointIndex) {

                    if (pointIndex >= 0) {
                        //point
                        return pathData.name + '，点：' + pointIndex + '/' + pathData.path.length;
                    }

                    return pathData.name + '，点数量' + pathData.path.length;
                },
                renderOptions: {
                    pathLineStyle: {
                        dirArrowStyle: true
                    },
                    getPathStyle: function(pathItem, zoom) {

                        var color = colors[pathItem.pathIndex % colors.length],
                            lineWidth = Math.round(4 * Math.pow(1.1, zoom - 3));

                        return {
                            pathLineStyle: {
                                strokeStyle: color,
                                lineWidth: lineWidth
                            },
                            pathLineSelectedStyle: {
                                lineWidth: lineWidth + 2
                            },
                            pathNavigatorStyle: {
                                fillStyle: color
                            }
                        };
                    }
                }
            });

            window.pathSimplifierIns = pathSimplifierIns;

            $('<div id="loadingTip">加载数据，请稍候...</div>').appendTo(document.body);

            $.getJSON('https://a.amap.com/amap-ui/static/data/big-routes.json', function(d) {

                $('#loadingTip').remove();

                var flyRoutes = [];

                for (var i = 0, len = d.length; i < len; i++) {

                    if (d[i].name.indexOf('乌鲁木齐') >= 0) {

                        d.splice(i, 0, {
                            name: '飞行 - ' + d[i].name,
                            path: PathSimplifier.getGeodesicPath(
                                d[i].path[0], d[i].path[d[i].path.length - 1], 100)
                        });

                        i++;
                        len++;
                    }
                }

                d.push.apply(d, flyRoutes);

                pathSimplifierIns.setData(d);

                //initRoutesContainer(d);

                function onload() {
                    pathSimplifierIns.renderLater();
                }

                function onerror(e) {
                    alert('图片加载失败！');
                }

                //创建一个巡航器
                var navg0 = pathSimplifierIns.createPathNavigator(1, {
                    loop: true, //循环播放
                    speed: 500000
                });

                navg0.start();


                var navg1 = pathSimplifierIns.createPathNavigator(0, {
                    loop: true,
                    speed: 1000000,
                    pathNavigatorStyle: {
                        width: 24,
                        height: 24,
                        //使用图片
                        content: PathSimplifier.Render.Canvas.getImageContent('./imgs/plane.png', onload, onerror),
                        strokeStyle: null,
                        fillStyle: null,
                        //经过路径的样式
                        pathLinePassedStyle: {
                            lineWidth: 6,
                            strokeStyle: 'black',
                            dirArrowStyle: {
                                stepSpace: 15,
                                strokeStyle: 'red'
                            }
                        }
                    }
                });

                navg1.start();

                var navg2 = pathSimplifierIns.createPathNavigator(7, {
                    loop: true,
                    speed: 500000,
                    pathNavigatorStyle: {
                        width: 16,
                        height: 32,
                        content: PathSimplifier.Render.Canvas.getImageContent('./imgs/car.png', onload, onerror),
                        strokeStyle: null,
                        fillStyle: null
                    }
                });

                navg2.start();

                var navg3 = pathSimplifierIns.createPathNavigator(5, {
                    loop: true,
                    speed: 500000,
                    pathNavigatorStyle: {
                        autoRotate: false, //禁止调整方向
                        pathLinePassedStyle: null,
                        width: 24,
                        height: 24,
                        content: PathSimplifier.Render.Canvas.getImageContent('./imgs/car-front.png', onload, onerror),
                        strokeStyle: null,
                        fillStyle: null
                    }
                });

                navg3.start();
            });
        });
    }
</script>

</body>
</html>