(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a269d12"],{"33de":function(e,t,n){"use strict";function i(){return new Promise(function(e,t){if(window.AMap)e(window.AMap);else{var n=document.createElement("script"),i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href","https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"),n.type="text/javascript",n.async=!1,n.src="https://webapi.amap.com/maps?v=1.4.15&callback=initAMap&key=0f31751255b231fcd092f6431b136a83&plugin=AMap.GraspRoad",n.onerror=t,document.head.appendChild(i),document.head.appendChild(n)}window.initAMap=function(){e(window.AMap)}})}n.d(t,"a",function(){return i})},3846:function(e,t,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"386d":function(e,t,n){"use strict";var i=n("cb7c"),o=n("83a1"),r=n("5f1b");n("214f")("search",1,function(e,t,n,a){return[function(n){var i=e(this),o=void 0==n?void 0:n[t];return void 0!==o?o.call(n,i):new RegExp(n)[t](String(i))},function(e){var t=a(n,e,this);if(t.done)return t.value;var s=i(e),c=String(this),l=s.lastIndex;o(l,0)||(s.lastIndex=0);var p=r(s,c);return o(s.lastIndex,l)||(s.lastIndex=l),null===p?-1:p.index}]})},"6b54":function(e,t,n){"use strict";n("3846");var i=n("cb7c"),o=n("0bfb"),r=n("9e1e"),a="toString",s=/./[a],c=function(e){n("2aba")(RegExp.prototype,a,e,!0)};n("79e5")(function(){return"/a/b"!=s.call({source:"a",flags:"b"})})?c(function(){var e=i(this);return"/".concat(e.source,"/","flags"in e?e.flags:!r&&e instanceof RegExp?o.call(e):void 0)}):s.name!=a&&c(function(){return s.call(this)})},"83a1":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},a29b:function(e,t,n){},aacb:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"current-map"}})},o=[],r=(n("8e6e"),n("456d"),n("ac6a"),n("6b54"),n("386d"),n("bd86")),a=n("33de"),s=(n("c385"),n("2f62"));function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(n,!0).forEach(function(t){Object(r["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var p={name:"CurrentMap",data:function(){return{theamap:null,createMap:null,polygon:[],origin:"",destination:"",taskId:0,prisonerList:{},markerList:[],infoWindow:{}}},mounted:function(){Array.isArray(this.multipleSelection)?this.$message.error("请先在任务列表中选择要查看的任务"):(this.multipleSelection.rail&&(this.polygon=this.multipleSelection.rail.reduce(function(e,t){var n=[t.lng,t.lat];return e.push(n),e},[])),this.taskId=this.multipleSelection.id,this.origin=this.multipleSelection.origin,this.destination=this.multipleSelection.destination,this.initMap(),this.livePosition())},computed:l({},Object(s["d"])({multipleSelection:function(e){return e.multipleSelection}})),methods:{initMap:function(){var e=this,t=this;Object(a["a"])().then(function(n){console.log("地图加载成功"),t.theamap=n,t.createMap=new n.Map("current-map",{zoom:12,scrollWheel:!0}),e.infoWindow=new n.InfoWindow({offset:new n.Pixel(0,-30)}),n.plugin(["AMap.Driving","AMap.MouseTool"],function(){var e=new n.Driving({map:t.createMap});e.search([{keyword:t.origin},{keyword:t.destination}]),t.drawPolygon=new n.Polygon({strokeColor:"#449dff",fillOpacity:0,path:t.polygon}),t.createMap.add(t.drawPolygon)})}).catch(function(){return console.log("地图加载失败")})},livePosition:function(){var e=this,t=this,n=null;if("WebSocket"in window){var i="ws://120.77.252.208:8080/gps/WebSocket/"+this.taskId;n=new WebSocket(i)}else alert("Not support websoket");n.onerror=function(){console.log("websocket_err")},n.onopen=function(){console.log("websocket_open")},n.onmessage=function(n){var i=JSON.parse(n.data),o=i.data,r=o.equip;console.log(o);var a=o.outboundRoadlog.longitude,s=o.outboundRoadlog.latitude,c=new AMap.LngLat(a,s);if(e.prisonerList[o.equip])e.markerList.forEach(function(t,n){var i=t.getExtData().id;if(i==r){e.prisonerList[r].path.push(c);var l=AMap.GeometryUtil.isPointInRing(c,e.polygon),p="",u="",d="",f="",g=o.stauts,h=o.prisoner,b=o.police,m=o.time;l?(p="green",u="正常"):(p="red",u="越界"),d="正常"==g?"green":"red",AMap.plugin("AMap.Geocoder",function(){var e=new AMap.Geocoder({radius:1e3});e.getAddress([a,s],function(e,n){"complete"===e&&"OK"===n.info?(f=n.regeocode.formattedAddress,t.content='\n                      <div style="width:200px;">\n                        <ul class="label-list">\n                          <li>脚扣：'.concat(r,"</li>\n                          <li>干警：").concat(b,"</li>\n                          <li>犯人：").concat(h,"</li>\n                          <li>地址：").concat(f,"</li>\n                          <li>时间：").concat(m,'</li>\n                          <li>状态：<span style="font-size:16px;padding:3px;background-color:').concat(p,';color:#fff;border-radius:5px;height:18px;line-height:18px;display: inline-block;text-align:center;">').concat(u,'</span></li>\n                          <li>设备：<span style="font-size:16px;padding:3px;background-color:').concat(d,';color:#fff;border-radius:5px;height:18px;line-height:18px;display: inline-block;text-align:center;">').concat(g,"</span></li>\n                        </ul>\n                      </div>")):console.log("根据经纬度查询地址失败")})});var w=e.prisonerList[r].path;e.prisonerList[r].polyline.setPath(w);var v=AMap.GeometryUtil.distance(w[w.length-2],w[w.length-1]);t.moveAlong(w.slice(w.length-2),3.6*v)}});else{e.$set(e.prisonerList,[r],{}),e.prisonerList[r].path=[c],e.prisonerList[r].polyline=new AMap.Polyline({map:e.createMap,strokeWeight:5,strokeStyle:"solid",strokeColor:"#"+Math.floor(200*Math.random()).toString(10),lineJoin:"round",lineCap:"round",strokeOpacity:0}),e.prisonerList[r].passedPolyline=new AMap.Polyline({map:e.createMap,strokeColor:"#"+Math.floor(200*Math.random()).toString(10),strokeWeight:5,strokeStyle:"solid",lineJoin:"round",lineCap:"round"});var l=new AMap.Marker({map:t.createMap,position:c,extData:{id:r}});l.setLabel({offset:new AMap.Pixel(20,10),content:"<div>".concat(o.prisoner,"</div>"),direction:"right"}),l.on("click",function(t){e.infoWindow.setContent(t.target.content),e.infoWindow.open(e.createMap,t.target.getPosition())}),l.on("moving",function(t){e.prisonerList[r].passedPolyline.setPath(e.prisonerList[r].path.slice(e.prisonerList[r].path.length-10))}),e.markerList.push(l)}}}}},u=p,d=(n("bef0"),n("2877")),f=Object(d["a"])(u,i,o,!1,null,null,null);t["default"]=f.exports},bef0:function(e,t,n){"use strict";var i=n("a29b"),o=n.n(i);o.a},c385:function(e,t,n){"use strict"}}]);