(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d900a98"],{"11a2":function(t,e,i){"use strict";var n=i("fba6"),r=i.n(n);r.a},"386d":function(t,e,i){"use strict";var n=i("cb7c"),r=i("83a1"),o=i("5f1b");i("214f")("search",1,function(t,e,i,a){return[function(i){var n=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,n):new RegExp(i)[e](String(n))},function(t){var e=a(i,t,this);if(e.done)return e.value;var s=n(t),l=String(this),c=s.lastIndex;r(c,0)||(s.lastIndex=0);var u=o(s,l);return r(s.lastIndex,c)||(s.lastIndex=c),null===u?-1:u.index}]})},"5dbc":function(t,e,i){var n=i("d3f4"),r=i("8b97").set;t.exports=function(t,e,i){var o,a=e.constructor;return a!==i&&"function"==typeof a&&(o=a.prototype)!==i.prototype&&n(o)&&r&&r(t,o),t}},"73dd":function(t,e,i){},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"8b97":function(t,e,i){var n=i("d3f4"),r=i("cb7c"),o=function(t,e){if(r(t),!n(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{n=i("9b43")(Function.call,i("11e9").f(Object.prototype,"__proto__").set,2),n(t,[]),e=!(t instanceof Array)}catch(r){e=!0}return function(t,i){return o(t,i),e?t.__proto__=i:n(t,i),t}}({},!1):void 0),check:o}},"8f24":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",{staticClass:"addroute-wrap"},[i("el-aside",{attrs:{width:"20%"}},[i("el-form",{ref:"addForm",attrs:{model:t.form,rules:t.addRules}},[i("el-form-item",{attrs:{label:"路线名：",prop:"name"}},[i("el-input",{attrs:{autocomplete:"off",placeholder:"请输入路线名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}},[i("i",{staticClass:"el-icon-close el-input__icon",attrs:{slot:"suffix"},on:{click:function(e){t.form.name=""}},slot:"suffix"})])],1),i("el-form-item",{attrs:{label:"出发地：",prop:"origin"}},[i("el-input",{attrs:{id:"origin",type:"text",placeholder:"请输入出发地"},on:{input:function(e){return t.placeAutoInput("origin")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.deletePlace("origin")}},model:{value:t.form.origin,callback:function(e){t.$set(t.form,"origin","string"===typeof e?e.trim():e)},expression:"form.origin"}},[i("i",{staticClass:"el-icon-close el-input__icon",attrs:{slot:"suffix",title:"出发地点"},on:{click:function(e){t.form.origin=""}},slot:"suffix"})])],1),i("el-form-item",{attrs:{label:"目的地：",prop:"destination"}},[i("el-input",{attrs:{id:"destination",type:"text",placeholder:"请输入目的地"},on:{input:function(e){return t.placeAutoInput("destination")}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.deletePlace("destination")}},model:{value:t.form.destination,callback:function(e){t.$set(t.form,"destination","string"===typeof e?e.trim():e)},expression:"form.destination"}},[i("i",{staticClass:"el-icon-close el-input__icon",attrs:{slot:"suffix",title:"目的地"},on:{click:function(e){t.form.destination=""}},slot:"suffix"})])],1)],1),t.resultVisible?i("placeSearch",{ref:"placeSearch",staticClass:"place-wrap",attrs:{result:t.result,left:t.offsetLeft,top:t.offsetTop,width:t.inputWidth,height:t.inputHeight},on:{getLocation:t.getPlaceLocation}}):t._e(),i("div",{staticClass:"btn-wrap"},[i("div",[i("el-button",{attrs:{type:"primary"},on:{click:t.searchRoute}},[t._v("查询路线")]),i("el-button",{attrs:{type:"primary"},on:{click:t.openDraw}},[t._v("划取围栏")])],1),i("div",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.saveRoute("addForm")}}},[t._v("保存路线")]),i("el-button",{attrs:{type:"primary"},on:{click:t.goback}},[t._v("返回上页")])],1)]),i("div",{attrs:{id:"panel"}})],1),i("el-main",{staticClass:"map-wrap"},[i("div",{staticClass:"map-btn"},[i("el-button",{attrs:{round:""},on:{click:t.closeDraw}},[t._v("关闭绘图")])],1),i("div",{attrs:{id:"addroute-container"}})])],1)},r=[],o=(i("8e6e"),i("ac6a"),i("456d"),i("a481"),i("96cf"),i("3b8d")),a=(i("7f7f"),i("386d"),i("bd86")),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"resultWrapper",staticClass:"result-list-wrapper"},[i("ul",{staticClass:"result-list address",attrs:{data:t.result}},t._l(t.result,function(e,n){return i("li",{key:e.index,ref:"resultItem",refInFor:!0,staticClass:"result-item address",on:{click:function(i){return t.setLocation(e)}}},[i("p",{staticClass:"result-name address",class:{active:n===t.activeIndex}},[t._v(t._s(e.name))]),e.address instanceof Array?[i("p",{staticClass:"result-adress address"},[t._v(t._s(e.district))])]:[i("p",{staticClass:"result-adress address"},[t._v(t._s(e.address))])]],2)}),0)])},l=[],c=(i("c5f6"),{props:{result:{type:Array,default:null},left:{type:Number,default:0},top:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0}},data:function(){return{activeIndex:0}},methods:{setLocation:function(t){this.$emit("getLocation",t)},initPos:function(){var t=this.$refs["resultWrapper"],e=document.getElementsByTagName("body");if(e){e[0].appendChild(t);var i=document.documentElement.clientHeight,n=0;this.result&&this.result.length>5?n=250:this.result&&this.result.length<=5&&(n=50*this.result.length),i-this.top<n?t.style.top=this.top-n-this.height+"px":t.style.top=this.top+"px",t.style.left=this.left+"px",t.style.width=this.width+"px"}},changePost:function(t,e,i,n){var r=this.$refs["resultWrapper"],o=document.documentElement.clientHeight,a=0;this.result&&this.result.length>5?a=250:this.result&&this.result.length<=5&&(a=50*this.result.length),r.style.top=o-e<a?e-a-n+"px":e+"px",r.style.left=t+"px",r.style.width=i+"px"},keydownSelect:function(t){var e=t||window.event||arguments.callee.caller.arguments[0];if(e&&38===e.keyCode){if(this.$refs["resultWrapper"]){var i=this.$refs["resultWrapper"].querySelectorAll(".result-item");i&&i.length>0&&(this.activeIndex--,this.activeIndex<5&&(this.$refs["resultWrapper"].scrollTop=0),5===this.activeIndex&&(this.$refs["resultWrapper"].scrollTop=250),-1===this.activeIndex&&(this.activeIndex=0))}}else if(e&&40===e.keyCode){if(this.$refs["resultWrapper"]){var n=this.$refs["resultWrapper"].querySelectorAll(".result-item");n&&n.length>0&&(this.activeIndex++,5===this.activeIndex&&(this.$refs["resultWrapper"].scrollTop=250),9===this.activeIndex&&(this.$refs["resultWrapper"].scrollTop=300),this.activeIndex===n.length&&(this.activeIndex=0,this.$refs["resultWrapper"].scrollTop=0))}}else e&&13===e.keyCode&&this.result&&this.result.length>this.activeIndex&&this.setLocation(this.result[this.activeIndex])}},mounted:function(){this.initPos(),document.addEventListener("keydown",this.keydownSelect,!1)},beforeDestroy:function(){document.removeEventListener("keydown",this.keydownSelect,!1)}}),u=c,p=(i("11a2"),i("2877")),d=Object(p["a"])(u,s,l,!1,null,"48ed7e6d",null),f=d.exports,h=i("365c"),m=i("2f62");function g(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?g(i,!0).forEach(function(e){Object(a["a"])(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var y={name:"AddNewRoute",components:{placeSearch:f},data:function(){var t=this,e=function(t,e,i){""===e?i(new Error("此项必须输入")):i()},i=function(e,i,n){""===i?n(new Error("此项必须输入")):t.form.slat&&0!==t.form.slat?n():n(new Error("请搜索并选择有经纬度的地点"))};return{form:{name:"",origin:"",destination:"",slat:0,slon:0,originLngLat:[],destinationLngLat:[],distance:"",rail:[]},addRules:{routeName:[{required:!0,validator:e,trigger:"blur"}],origin:[{required:!0,validator:i,trigger:"change"}],destination:[{required:!0,validator:i,trigger:"change"}]},inputId:"",result:[],resultVisible:!1,inputWidth:0,inputHeight:0,offsetLeft:0,offsetTop:0,routeMap:null}},computed:v({},Object(m["d"])({areaId:function(t){return t.areaId},tableData:function(t){return t.routeManage.tableData},editRoute:function(t){return t.routeManage.editRoute}})),mounted:function(){null!==this.editRoute?(this.form=this.editRoute,this.form.slat=1,this.editMap()):this.initMap(),document.addEventListener("click",this.hidePlaces,!1),window.addEventListener("resize",this.changePos,!1)},methods:{editMap:function(){var t=this,e=this.form.rail.reduce(function(t,e){var i=[e.lng,e.lat];return t.push(i),t},[]);this.routeMap=new AMap.Map("addroute-container",{city:"山东",zoom:12,scrollWheel:!0}),AMap.plugin(["AMap.Driving","AMap.MouseTool"],function(){var i=new AMap.Driving({map:t.routeMap,panel:"panel"});i.search([{keyword:t.form.origin},{keyword:t.form.destination}]),t.drawPolygon=new AMap.Polygon({strokeColor:"#E86D01",fillOpacity:0,path:e}),t.routeMap.add(t.drawPolygon)})},initMap:function(){this.routeMap=new AMap.Map("addroute-container",{city:"山东",zoom:12,scrollWheel:!0})},placeAutoInput:function(t){var e=this,i=document.getElementById(t),n=i.value;0===n.trim().length&&(this.resultVisible=!1),AMap.plugin("AMap.Autocomplete",function(){var r={city:"全国"},o=new AMap.Autocomplete(r);o.search(n,function(n,r){if("OK"===r.info){var o=i.getBoundingClientRect();e.inputWidth=i.clientWidth,e.inputHeight=i.clientHeight+2,e.offsetTop=o.top+e.inputHeight,e.offsetLeft=o.left,e.result=r.tips,e.inputId=t,e.resultVisible=!0}})})},hidePlaces:function(t){var e=t.target;e.classList.contains("address")||(this.resultVisible=!1)},changePos:function(){if(this.inputId&&this.$refs["placeSearch"]){var t=document.getElementById(this.inputId),e=t.getBoundingClientRect(),i=t.clientWidth,n=t.clientHeight+2,r=e.top+n,o=e.left;this.$refs["placeSearch"].changePost(o,r,i,n)}},getPlaceLocation:function(t){t&&(console.log(t),this.resultVisible=!1,t.location&&t.location.getLat()?(this.pickAddress(this.inputId,t.location.getLng(),t.location.getLat()),this.$refs.addForm.validateField(this.inputId)):this.geocoder(t.name,this.inputId))},pickAddress:function(t,e,i){var n=this;AMapUI.loadUI(["misc/PositionPicker"],function(r){n.routeMap=new AMap.Map("addroute-container",{zoom:16,scrollWheel:!0,center:[e,i]}),n.positionPicker=new r({mode:"dragMarker",map:n.routeMap}),n.positionPicker.on("success",function(e){console.log(t),n.form.slat=e.position.lat,n.form.slon=e.position.lng,n.form[t]=e.address,"origin"===t?n.form.originLngLat=[e.position.lng,e.position.lat]:n.form.destinationLngLat=[e.position.lng,e.position.lat]}),n.positionPicker.on("fail",function(t){n.$message.error("地址选取失败")}),n.positionPicker.start(),AMap.plugin("AMap.ToolBar"),n.routeMap.addControl(new AMap.ToolBar({liteStyle:!0}))})},geocoder:function(t,e){var i=this;AMap.plugin("AMap.Geocoder"),this.routeMap.addControl(n);var n=new AMap.Geocoder({radius:1e3});n.getLocation(t,function(n,r){if("complete"===n&&"OK"===r.info){var o=r.geocodes;o&&o.length>0&&(console.log(o[0].location),i.form.slat=o[0].location.getLat(),i.form.slon=o[0].location.getLng(),i.form[e]=t,"origin"===inputId?i.form.originLngLat=[o[0].location.getLng(),o[0].location.getLat()]:i.form.destinationLngLat=[o[0].location.getLng(),o[0].location.getLat()],i.$refs.addForm.validateField(e))}})},deletePlace:function(t){this.form.slat=0,this.form.slon=0,this.form.originLngLat=[],this.form.destinationLngLat=[],this.$refs.addForm.validateField(t)},searchRoute:function(){this.positionPicker.stop();var t=this;AMap.plugin("AMap.Driving");var e=new AMap.Driving({map:this.routeMap,panel:"panel"});e.search([{keyword:this.form.origin},{keyword:this.form.destination}],function(e,i){"complete"===e?t.$message.success("绘制驾车路线完成"):t.$message.error("获取驾车数据失败："+i)}),this.form.distance=(AMap.GeometryUtil.distanceOfLine([this.form.originLngLat,this.form.destinationLngLat])/1e3).toFixed(2)+"km",console.log(this.form.distance)},openDraw:function(){var t=this;AMap.plugin("AMap.MouseTool"),this.mouseTool=new AMap.MouseTool(this.routeMap);this.mouseTool.polygon({strokeColor:"#E86D01",fillOpacity:0});AMap.event.addListener(this.mouseTool,"draw",function(e){t.form.rail=e.obj.getPath()})},closeDraw:function(){this.mouseTool.close(!0)},saveRoute:function(t){var e=this;this.$refs[t].validate(function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(i){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!i){t.next=20;break}if(!e.form.id){t.next=8;break}return console.log("编辑"),t.next=5,Object(h["l"])(e.form);case 5:setTimeout(function(){e.$message.success("新增路线成功")},300),t.next=15;break;case 8:return console.log("新增"),e.form.areaId=e.areaId,t.next=12,Object(h["e"])(e.form);case 12:n=t.sent,e.tableData.unshift(n),setTimeout(function(){e.$message.success("新增路线成功")},300);case 15:e.form={name:"",origin:"",destination:"",slat:0,slon:0,originLngLat:[],destinationLngLat:[],distance:"",rail:[]},e.$store.commit("updateEditRoute",null),e.$router.replace("/manage/routemanage"),t.next=22;break;case 20:return setTimeout(function(){e.$message.error("新增路线失败")},300),t.abrupt("return",!1);case 22:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())},goback:function(){this.form={name:"",origin:"",destination:"",slat:0,slon:0,originLngLat:[],destinationLngLat:[],distance:"",rail:[]},this.$store.commit("updateEditRoute",null),this.$router.back()}},beforeDestroy:function(){document.removeEventListener("click",this.hidePlaces,!1)}},b=y,k=(i("a34f"),Object(p["a"])(b,n,r,!1,null,"44121d19",null));e["default"]=k.exports},a34f:function(t,e,i){"use strict";var n=i("73dd"),r=i.n(n);r.a},aa77:function(t,e,i){var n=i("5ca1"),r=i("be13"),o=i("79e5"),a=i("fdef"),s="["+a+"]",l="​",c=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),p=function(t,e,i){var r={},s=o(function(){return!!a[t]()||l[t]()!=l}),c=r[t]=s?e(d):a[t];i&&(r[i]=c),n(n.P+n.F*s,"String",r)},d=p.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(u,"")),t};t.exports=p},c5f6:function(t,e,i){"use strict";var n=i("7726"),r=i("69a8"),o=i("2d95"),a=i("5dbc"),s=i("6a99"),l=i("79e5"),c=i("9093").f,u=i("11e9").f,p=i("86cc").f,d=i("aa77").trim,f="Number",h=n[f],m=h,g=h.prototype,v=o(i("2aeb")(g))==f,y="trim"in String.prototype,b=function(t){var e=s(t,!1);if("string"==typeof e&&e.length>2){e=y?e.trim():d(e,3);var i,n,r,o=e.charCodeAt(0);if(43===o||45===o){if(i=e.charCodeAt(2),88===i||120===i)return NaN}else if(48===o){switch(e.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+e}for(var a,l=e.slice(2),c=0,u=l.length;c<u;c++)if(a=l.charCodeAt(c),a<48||a>r)return NaN;return parseInt(l,n)}}return+e};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof h&&(v?l(function(){g.valueOf.call(i)}):o(i)!=f)?a(new m(b(e)),i,h):b(e)};for(var k,w=i("9e1e")?c(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;w.length>x;x++)r(m,k=w[x])&&!r(h,k)&&p(h,k,u(m,k));h.prototype=g,g.constructor=h,i("2aba")(n,f,h)}},fba6:function(t,e,i){},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);